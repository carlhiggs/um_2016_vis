---
title: "Tree coverage percentage map"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: scroll
    social: [ "twitter", "facebook", "menu" ]
    source_code: embed
    theme: flatly
runtime: shiny

---


```{r setup, include=FALSE}
# Load packages and initialize data here
library(flexdashboard)
library(rgdal)
library(leaflet)
library(magrittr)
library(knitr)
library(shiny)
```

Map
=========================

Sidebar {.sidebar} 
----------------------------
An interactive visualisation of tree coverage for local government areas (LGAs) in Sydney, detailing percent on public, private or other land.  Based on analysis of modified mesh block data derived from Urban Monitor imagery for 2016. Centre for Urban Resarch, RMIT 2019.

```{r}
hr()

# selectInput("state", label = "Select an indicator: ",
#            choices = state.abb, selected = "Private")

```

Based on code from [Jasmine Dumas](http://jasdumas.github.io/)

Map {data-height=1000}
----------------------------

```{r}
# area level data
url_lga = "https://www.dropbox.com/s/eu7lfhc8dexujqb/um_2016_pp_lga.geojson?dl=1"
file <- "um_2016_pp_lga"
download.file(url_lga, file)
# file = "~/urban_monitor/um_2016_vis/um_2016_pp_lga.geojson"
um_2016_lga <- rgdal::readOGR(file, "OGRGeoJSON")

# color palette
renderLeaflet({
  
pal <- colorBin(palette = "BuPu", domain = um_2016_lga$f4, bins = 8)

area_popup <- paste0("<strong>LGA: </strong>", 
                      um_2016_lga$f2, 
                      "<br><strong>Public: </strong>", 
                      um_2016_lga$f5,"%", 
                      "<br><strong>Private: </strong>",
                      um_2016_lga$f4,"%", 
                      "<br><strong>Other: </strong>",
                      um_2016_lga$f3,"%")
# plot the map
leaflet(data = um_2016_lga()) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(fillColor = ~pal(f4), 
              fillOpacity = 0.7, 
              color = "#BDBDC3", 
              weight = 1, 
              popup = area_popup) %>%
  addLegend("bottomleft", 
            pal = pal, 
            values = ~f4,
            title = "Public % tree coverage",
            opacity = 1)
})
```


Reproducible Script
===================================== 

```{r, echo=TRUE, eval=FALSE}
# necessary libraries
library(rgdal)
library(leaflet)
library(magrittr)
library(knitr)

url_lga = "https://www.dropbox.com/s/eu7lfhc8dexujqb/um_2016_pp_lga.geojson?dl=1"
file <- "um_2016_pp_lga"
download.file(url_lga, file)
um_2016_lga <- rgdal::readOGR(file, "OGRGeoJSON")
pal <- colorBin(palette = "BuPu", domain = um_2016_lga$f4, bins = 8)

# f2 lga
# percent any tree
# f3 other
# fr private
# f5 public

# pop values
area_popup <- paste0("<strong>LGA: </strong>", 
                      um_2016_lga$f2, 
                      "<br><strong>Public: </strong>", 
                      um_2016_lga$f5,"%", 
                      "<br><strong>Private: </strong>",
                      um_2016_lga$f4,"%", 
                      "<br><strong>Other: </strong>",
                      um_2016_lga$f3,"%")
# plot the map
leaflet(data = um_2016_lga) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(fillColor = ~pal(f4), 
              fillOpacity = 0.7, 
              color = "#BDBDC3", 
              weight = 1, 
              popup = area_popup) %>%
  addLegend("bottomleft", 
            pal = pal, 
            values = ~f4,
            title = "Public % tree coverage",
            opacity = 1)

```


About
===================================== 

Based on code from https://jasminedumas.shinyapps.io/Choropleth_Zipcodes/#map
